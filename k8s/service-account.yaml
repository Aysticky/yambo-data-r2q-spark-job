---
# Service Account with IRSA (IAM Roles for Service Accounts)
#
# IRSA SETUP:
# 1. Create IAM role with trust policy for OIDC provider
# 2. Attach policies (S3, DynamoDB, Secrets Manager, CloudWatch)
# 3. Annotate service account with IAM role ARN
# 4. Spark pods automatically get temporary AWS credentials
#
# WHY IRSA OVER ACCESS KEYS:
# - No long-lived credentials
# - Automatic rotation
# - Fine-grained permissions per service account
# - Audit via CloudTrail
#
# TERRAFORM CREATES THE IAM ROLE:
# This is just the K8s service account.
# The IAM role ARN is added via annotation after terraform apply.
apiVersion: v1
kind: ServiceAccount
metadata:
  name: spark-job-sa
  namespace: spark-jobs
  annotations:
    # This ARN is created by Terraform (modules/eks/irsa.tf)
    # Update this after running: terraform output spark_job_irsa_role_arn
    eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/yambo-spark-job-irsa-dev
  labels:
    app: yambo-spark-job
    environment: dev

---
# Service Account for Spark Operator itself
# (Different from job service account)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: spark-operator-sa
  namespace: spark-jobs
  labels:
    app: spark-operator
    environment: dev
